<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../nomie-plugin.js"></script>
  </head>
  <body class="w-screen h-screen flex items-center justify-center flex-col">
    
    <h1>Total Test 2222!</h1>
    <button id="select-button" class="bg-green-500 text-white py-1 px-2 rounded-md mt-2" onclick="selectTrackable()">
      Select Trackable
    </button>

    <script>
      let date = new Date();

      const plugin = new NomiePlugin({
        name: "Total Test",
        addToCaptureMenu: true,
        emoji: "🏭",
        version: "1.0",
        description: "Get Totals for a Specific Trackable",
        uses: ["searchNotes","createNote","selectTrackables","getTrackableUsage"],
      });

      let lastTrackable = localStorage.getItem('last-trackable');

      const selectTrackable = async ()=>{
        const trackables = await plugin.selectTrackables();
        if(trackables.length) {
          setLastTrackable(trackables[0].id);
        }
      }
      const getLastTrackable = ()=>{
        return localStorage.getItem('last-trackable')
      }
      const setLastTrackable = (tag)=>{
        lastTrackable = tag;
        localStorage.setItem('last-trackable', tag)
        renderTrackableButton();
      }

      const getUsage = async (tag)=>{
        console.log(`⛔️⛔️⛔️⛔️⛔️ get usage for ${tag}`)
        const call = await plugin.getTrackableUsage({ tag, daysBack: 30 });
        const usage = call.usage;
        console.log("⛔️⛔️⛔️⛔️⛔️", usage.values);
      }

      const renderTrackableButton = ()=>{
        if(lastTrackable) {
          getUsage(lastTrackable);
          document.getElementById('select-button').innerHTML = lastTrackable
        }
      }

      plugin.onUIOpened(async ()=>{
        renderTrackableButton();
      });

    </script>
  </body>
</html>
